<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
    <title>Document</title>
</head>

<body>
    <canvas id="myCanvas" width="960" height="540"></canvas>
    <script>
        window.addEventListener("load", init);
        function init() {
            let stage = new createjs.Stage("myCanvas")
            let count = 0
            let enemyList = []
            let bulletList = []

            //画面の色を作る
            let bg = new createjs.Shape()
            bg.graphics.beginFill("black").drawRect(0, 0, 960, 540)//(0,0)〜(960,540)までを黒い画面にする
            stage.addChild(bg)

            //プレイヤーを作る
            let player = new createjs.Shape()
            player.graphics.beginFill("white").drawCircle(0, 0, 10)
            stage.addChild(player)

            stage.addEventListener("click", handleClick)//クリックした際、handleClick関数を実行

            createjs.Ticker.setFPS(60)//１秒間に60回の画面更新を行う
            createjs.Ticker.addEventListener("tick", handleTick);//マウスを動かす際の処理関数へ移る


            function handleClick() {//scene=0はタイトル画面、1はゲーム画面を表す。
                //弾を発射する処理
                let bullet = new createjs.Shape()
                bullet.graphics.beginFill("white").drawCircle(0, 0, 3)
                bullet.x = player.x
                bullet.y = player.y
                bulletList.push(bullet)
                stage.addChild(bullet)
            }



            function handleTick() {//プレイヤーの移動、敵の出現
                player.x = stage.mouseX;
                player.y = stage.mouseY;

                if (count % 100 === 0) {
                    let enemy = new createjs.Shape()
                    enemy.graphics.beginFill("red").drawCircle(0, 0, 10)

                    enemy.x = 960 * Math.random()
                    enemy.y = 0

                    stage.addChild(enemy)
                    enemyList.push(enemy)
                }
                count++


                for (let i = 0; i < enemyList.length; i++)enemyList[i].y += 2//敵の移動
                for (let i = 0; i < bulletList.length; i++) bulletList[i].y -= 10//弾の移動

                for (let i = 0; i < enemyList.length; i++) {//プレイヤーが敵に触れてしまった(要は同じ座標上に位置してしまった)らgameoverする処理
                    let localPoint = enemyList[i].globalToLocal(player.x, player.y)//playerの座標を取得?
                    if (enemyList[i].hitTest(localPoint.x, localPoint.y)) gameOver()//敵のいづれかに触れたらgameOver関数に移動
                }

                for (let i = 0; i < bulletList.length; i++) {//弾が敵に当たった時の処理
                    for (let j = 0; j < enemyList.length; j++) {
                        let localPoint = bulletList[i].localToLocal(0, 0, enemyList[j])
                        if (enemyList[j].hitTest(localPoint.x, localPoint.y)) {
                            stage.removeChild(bulletList[i])//ステージ上から球を消す
                            bulletList.splice(i, 1)//iにある要素を１個消す

                            stage.removeChild(enemyList[j])//ステージ上から敵を消す
                            enemyList.splice(j, 1)//iにある要素を１個消す
                        }
                    }
                }


                stage.update()
            }



        }
    </script>
</body>

</html>